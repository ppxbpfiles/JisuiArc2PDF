# コマンドラインが苦手な方のための使い方ガイド

このガイドは、コマンドラインの操作に慣れていない方でも `JisuiArc2PDF` を使えるように、準備から実行までの手順を詳しく解説します。

## 1. 準備編：ツールの用意と配置

最初に、変換に必要なツールをすべて一つのフォルダに集めます。

### 手順1：作業フォルダの作成
まず、作業用のフォルダをPCの好きな場所（例: デスクトップやドキュメントなど）に作成します。このガイドでは、例として `C:\JisuiTools` というフォルダ名で説明します。

### 手順2：ツールのダウンロードと配置
以下の4つのツールを、作成した作業フォルダ（`C:\JisuiTools`）の中に集めます。

#### ① JisuiArc2PDF スクリプト
- **ファイル**: `JisuiArc2PDF.ps1` と `JisuiArc2PDF.bat`
- **入手方法**: この2つのファイルを作業フォルダに置きます。

#### ② 7-Zip
- **役割**: 書庫ファイル（.rar, .zipなど）を展開するために使います。
- **入手方法**:
    1. [7-Zip公式サイト](https://www.7-zip.org/) にアクセスします。
    2. 「Windows 64ビット x64」の行にある「ダウンロード」リンクをクリックし、インストーラーをダウンロードします。
    3. ダウンロードしたインストーラーを実行して、7-Zipをインストールします。（設定はすべてデフォルトのままでOKです）
    4. インストール先フォルダ（通常は `C:\Program Files\7-Zip`）を開き、`7z.exe` と `7z.dll` の2つのファイルをコピーします。
    5. コピーした2つのファイルを、作業フォルダ（`C:\JisuiTools`）に貼り付けます。

#### ③ ImageMagick
- **役割**: 画像のサイズ変更や圧縮などの画像処理を行います。
- **入手方法**:
    1. [ImageMagick公式サイト](https://imagemagick.org/script/download.php) にアクセスします。
    2. 「Windows Binary Release」のセクションから、ファイル名に `static` と含まれるzipファイル（例: `ImageMagick-7.X.X-X-Q16-HDRI-x64-static.zip`）を探してダウンロードします。
    3. ダウンロードしたzipファイルを解凍（展開）します。
    4. 解凍したフォルダの中から `magick.exe` をコピーします。
    5. コピーしたファイルを、作業フォルダ（`C:\JisuiTools`）に貼り付けます。
- **ポイント**: static版の `magick.exe` は、それ単体で動作し、他にDLLファイルなどを必要としないため、管理がとても簡単です。

#### ④ PDFCPU
- **役割**: 画像ファイルをまとめてPDFを作成し、PDFのビューア設定を調整します。
- **入手方法**:
    1. [PDFCPU公式サイト](https://pdfcpu.io/download) にアクセスします。
    2. 「Windows (64-bit)」のセクションにある `pdfcpu_..._Windows_x86_64.zip` というリンクをクリックして、zipファイルをダウンロードします。
    3. ダウンロードしたzipファイルを解凍（展開）します。
    4. 解凍したフォルダの中から `pdfcpu.exe` をコピーします。
    5. コピーしたファイルを、作業フォルダ（`C:\JisuiTools`）に貼り付けます。

#### ⑤ QPDF（オプション）
- **役割**: PDFのリニアライズ処理に使用されます（オプション）。
- **入手方法**:
    1. [QPDF公式サイト](https://github.com/qpdf/qpdf/releases) にアクセスします。
    2. 最新バージョンの `qpdf-...-mingw64.zip` というリンクをクリックして、zipファイルをダウンロードします。
    3. ダウンロードしたzipファイルを解凍（展開）します。
    4. 解凍したフォルダの中から `qpdf.exe` と関連するDLLファイル（例: `qpdf30.dll`）をコピーします。
    5. コピーしたファイルを、作業フォルダ（`C:\JisuiTools`）に貼り付けます。

### 手順3：最終確認
すべての手順が終わると、作業フォルダ（`C:\JisuiTools`）には以下の6つのファイルが揃っているはずです。
- `JisuiArc2PDF.ps1`
- `JisuiArc2PDF.bat`
- `7z.exe`
- `7z.dll`
- `magick.exe`
- `pdfcpu.exe`

QPDFをインストールした場合は、`qpdf.exe` と関連するDLLファイル（例: `qpdf30.dll`）も作業フォルダに配置されている必要があります。QPDFがスクリプトと同じフォルダに配置されているか、環境変数PATHに登録されている場合にのみ、リニアライズ機能が有効になります。

これで準備は完了です。

---

## 2. 実践編：ドラッグ＆ドロップでPDFを作成

準備が整ったら、PDFの作成はとても簡単です。

1.  **ドラッグ＆ドロップ**:
    -   PDFにしたい書庫ファイル（`.rar` や `.zip`）を、`JisuiArc2PDF.bat` のアイコンの上にマウスでドラッグ＆ドロップします。
    -   黒い画面（コマンドプロンプト）が表示されます。

2.  **対話形式で設定**:
    -   画面に、画質(Quality)や解像度(Resolution)、圧縮の判断基準(threshold)などに関する質問が順番に表示されます。
    -   `[ ]` が付いている質問は、**何も入力せずにEnterキーを押す**と、`[ ]` の中のおすすめ設定（デフォルト値）が自動的に使われます。
    -   こだわりがなければ、**すべての質問に対して、ただEnterキーを押していくだけでOK**です。
    -   途中で「Adjust Grayscale contrast (y/n)?」という質問が表示されます。これは主に白黒ページの紙焼け（黄ばみ）を軽減する機能です。必要であれば `y` を入力してください。
    -   次に「Auto-adjust Color contrast (y/n)?」という質問が表示されます。これはカラーページのコントラストを自動で最適化する便利な機能です。通常は `y` を入力してEnterキーを押すことをお勧めします。
    -   自動調整を選ばなかった場合のみ、「Adjust Color contrast (y/n)?」と手動での調整を聞かれます。必要であれば `y` を入力して値を設定してください。
    -   途中で「Deskew (auto-straighten) (y/n)? [n]:」という質問が表示されます。これはスキャン時に発生した画像の傾きを自動で補正する機能です。必要であれば `y` を入力して有効にしてください。
    -   最後に「Linearize PDF (web optimization) (y/n)? [n]:」と尋ねられます。ウェブでPDFを表示する際に読み込みを高速化したい場合は `y` と入力してください。
    -   **注意**: この機能を有効にするには、準備編で説明した**QPDFがインストールされている必要があります。** QPDFがない場合、`y`と入力してもリニアライズ処理はスキップされます。
    -   **注意**: リニアライズされたPDFは、一部の古いPDFビューアや特殊な処理系では正しく読み取れない場合があります。主にローカルまたは内部ネットワークでの利用を想定している場合、または互換性が重要な場合は、`n` と入力してこの機能を無効にしてください。

3.  **実行確認**:
    -   すべての質問に答えると、最終的に実行されるコマンドが表示され、「Press Enter to run, or Ctrl+C to cancel...」というメッセージで一時停止します。
    -   これは最終確認の画面です。そのまま **Enterキーを押す**と、PDF変換が始まります。

4.  **完了**:
    -   処理が始まると、たくさんの文字が画面に流れます。
    -   「Done. Press any key to exit.」と表示されたら、すべての処理は完了です。
    -   元の書庫ファイルがあった場所と同じ場所に、新しいPDFファイルが作成されていることを確認してください。

---

## 3. トラブル解決編

もし、うまくいかない場合は以下を確認してください。

### エラー: 「'pwsh' は、内部コマンドまたは外部コマンド、操作可能なプログラムまたはバッチ ファイルとして認識されていません。」

このエラーメッセージが表示された場合、PowerShell 7が正しくインストールされていないか、システムが `pwsh.exe` を見つけられない状態になっています。

-   **原因**:
    -   PowerShell 7がPCにインストールされていない。
    -   インストールはしたが、PATH環境変数への登録がされていない。

-   **解決策**:
    1. [PowerShell 7の公式サイト](https://learn.microsoft.com/ja-jp/powershell/scripting/install/installing-powershell-on-windows)にアクセスします。
    2. 「Downloads (stable)」のセクションから、`PowerShell-7.X.X-win-x64.msi` をダウンロードして実行します。
    3. インストーラーの途中で「Add PowerShell to Path Environment Variable」という項目が表示されたら、**必ずチェックを入れて**インストールを完了してください。
    4. インストール完了後、PCを再起動すると問題が解決する場合があります。